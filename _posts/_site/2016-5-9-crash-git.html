<h2 id="git">Git简介</h2>
<p>Git是一种分布式版本控制系统，由开发出Linux的大神Linus撰写。SVN是目前使用最多的集中式版本库控制系统。
## 安装Git
在Ubuntu下可以用下面的命令安装：</p>

<p><code>sudo apt-get install git</code></p>

<p>在Mac下则使用Homebrew：</p>

<p><code>brew install git</code></p>

<p>安装完成后设置一下姓名，邮箱和默认编辑器：</p>

<p><code>
git config --global user.name "Miachel Gu"
git config --global user.email "anyinlover@gmail.com"
git config --global core.editor vim
</code></p>

<p><code>--global</code>是一个全局参数，也可以对每个Git仓库设置不同的配置。</p>

<h2 id="section">创建版本库</h2>

<h3 id="section-1">创建</h3>
<p>在某个目录下使用下面的命令，将其初始化成一个Git仓库：</p>

<p><code>git init</code></p>

<h3 id="section-2">添加文件到暂存区</h3>
<p>新添或者修改一个文件后，使用<code>git add</code>将其添加到暂存区：</p>

<p><code>git add filename</code>
### 从暂存区添加到版本库
使用命令<code>git commit</code>将暂存区文件提交到仓库, <code>-m</code>后是提交的备注：</p>

<p><code>git commit -m "add a file"</code></p>

<p><code>add</code>和<code>commit</code>分成了两步，可以多次<code>add</code>，一次<code>commit</code>。</p>

<h2 id="section-3">版本管理</h2>
<p><code>git status</code>查看仓库当前的状态：</p>

<p><code>git status</code></p>

<p><code>git diff</code>比较修改过的文件：</p>

<p><code>git diff filename</code></p>

<h3 id="section-4">版本回退</h3>

<p><code>git log</code>可以用来查看版本记录，其中一大串数字显示的是SHA1计算出来的<code>commit id</code>。</p>

<p>用下面的命令可以回退到上一版本，<code>HEAD</code>表示当前版本，<code>HEAD^</code>表示上一版本。依次类推，<code>HEAD^^</code>表示上上版本, <code>HEAD~100</code>表示往上100个版本：</p>

<p><code>git reset --hard HEAD^</code></p>

<p>如果又反悔回退了，只要知道<code>commit_id</code>，仍然可以重新回退到新版本</p>

<p><code>git reset --hard commit_id</code></p>

<p><code>commit_id</code>可以只写前面几位，唯一匹配即可。</p>

<p>如果关闭窗口后找不到新版本的<code>commit_id</code>了，那就需要使用下面的命令来查看命令历史：</p>

<p><code>git reflog</code></p>

<h3 id="section-5">工作区和缓存区</h3>

<p>Git最重要的概念就是三分天下：工作区-缓存区-版本库。<code>add</code>操作是将工作区的文件加到缓存区中，<code>commit</code>操作是将缓存区文件加到版本库。</p>

<h3 id="section-6">管理修改</h3>

<p>Git管理的是修改而非文件。下面的命令可以比较版本库中和工作区中文件的差异：</p>

<p><code>git diff HEAD -- filename</code></p>

<h3 id="section-7">撤销修改</h3>

<p>如果只是修改了工作区的文件，用下面的命令可以撤销到上一次<code>commit</code>或<code>add</code>提交后的状态：</p>

<p><code>git checkout -- filename</code></p>

<p>如果修改已经提交到暂存区了，那就需要使用下面的命令丢弃暂存区修改：</p>

<p><code>git reset HEAD filename</code></p>

<p>记得丢弃暂存区修改后还要丢弃工作区修改。</p>

<h3 id="section-8">删除文件</h3>
<p>使用<code>git rm</code>删除文件，后面还需要<code>git commit</code>提交修改：</p>

<p><code>git rm filename</code></p>

<p>假如误删等同于丢弃暂存区修改，想要还原需要两步走：</p>

<p><code>
git reset HEAD filename
git checkout -- filename
</code></p>

<h2 id="section-9">远程仓库</h2>
<p>使用SSH方式连接github，需要配置SSH Key。假如主目录下无隐藏文件夹.ssh，就创建一个<code>ssh-keygen -t rsa -C "anyinlover@gmail.com"</code>。在.ssh文件下有id_rsa和id_rsa.pub两个文件，将id_rsa.pub内容复制到GitHub SSH Keys，注意不要有多余的空格或换行符。</p>

<h3 id="section-10">添加远程库</h3>
<p>在github上Create a new repo，命名为learngit，在本地仓库已存在的情况下，将本地库与远程库相关联：</p>

<p><code>git remote add origin git@github.com:anyinlover/learngit</code></p>

<ul>
  <li>执行错误提醒： fatal: remote origin already exists.
解决办法：<code>git remote rm origin</code></li>
</ul>

<p>远程库默认名字是origin，不必修改。
推送本地库内容到远程库：</p>

<p><code>git push -u origin master</code></p>

<p>参数<code>-u</code>用以将本地master分支与远程master分支关联，以后推送只需要:</p>

<p><code>git push origin master</code></p>

<ul>
  <li>ssh警告
第一次 push 或 clone时出现，用以显示第一次验证github服务器上的SSH key，输入yes即可。</li>
</ul>

<h3 id="section-11">克隆远程库</h3>
<p>对于新项目而言，最好先在在gihub上创建新仓库，然后克隆到本地：</p>

<p><code>git clone git@github.com:guguoshenqi/gitskill.git</code></p>

<p>Git其实还能支持其他协议，比如<code>https</code>，但<code>https</code>速度慢，且每次推送需要输入口令，只有在只开放http端口的公司内网环境下使用。</p>

<h2 id="section-12">分支管理</h2>
<p>分支提供了平行世界的功能，使多人协作更加的方便。</p>

<h3 id="section-13">创建与合并分支</h3>
<p>在版本回退中，每次提交Git都会串成时间线也就是分支。在Git中，默认的那个分支称为主分支，即<code>master</code>分支。在前面的单分支情况下，<code>HEAD</code>严格来说是指向<code>master</code>的，而<code>master</code>才是指向提交的，所以<code>HEAD</code>指向的就是当前分支。</p>

<p><img src="\img\git_1" alt="" /></p>

<p>当新建分支<code>dev</code>时，指向与<code>master</code>相同的提交，并把<code>HEAD</code>指向<code>dev</code>，表示当前分支在<code>dev</code>上。</p>

<p><img src="\img\git_2" alt="" /></p>

<p>现在对工作区的修改和提交发生在了<code>dev</code>分支上，提交一次后会变成下面这样：</p>

<p><img src="\img\git_3" alt="" /></p>

<p>如果<code>dev</code>分支的工作完成了，需要将其合并到<code>master</code>上，只需要让<code>master</code>指向<code>dev</code>对应的提交，合并就完成了：</p>

<p><img src="\img\git_4" alt="" /></p>

<p>这个时候删除<code>dev</code>分支也没有关系（就是删除一个指针），删完后就变成：</p>

<p><img src="\img\git_5" alt="" /></p>

<p>首先创建并切换到新分支<code>dev</code>上：</p>

<p><code>git checkout -b dev</code></p>

<p>上面的命令相当于下面两步：</p>

<p><code>
git branch dev
git checkout dev
</code></p>

<p><code>git branch</code>命令可以查看所有分支，带星号的是当前分支。</p>

<p>如果想切换分支，使用下面的命令：</p>

<p><code>git chekcout master</code></p>

<p>如果想把<code>dev</code>分支的内容合并到<code>master</code>分支上,<code>Fast-forward</code>是一种快速合并的模式，也就是前面提到的移动指针。有时候可能会不适用这种快速合并的方式。</p>

<p><code>git merge dev</code></p>

<p>合并完成后就可以放心的删除<code>dev</code>分支了：</p>

<p><code>git branch -d dev</code></p>

<h3 id="section-14">解决冲突</h3>
<p>当两个分支都有新的提交时，会发生合并冲突，需要手工修改后重新提交。
可以用<code>git log --graph</code>查看分支合并图:</p>

<p><code>git log --graph --pretty=oneline --abbrev-commit</code></p>

<h3 id="section-15">分支管理策略</h3>
<p>Git默认会使用<code>Fast forward</code>模式，这种模式在删除分支后，会丢掉分支信息。如果禁用Fast forward模式合并，会产生一个新的commit，从而可以保存被删除分支信息，使用<code>--no-ff</code>参数：</p>

<p><code>git merge --no-ff -m "merge with no-ff" dev</code></p>

<p>实际开发的分支原则
1. master分支非常稳定，只用来发布新版本
2. 在dev分支上干活，到版本发布时才合并到master
3. 多人协作时每个人在自己分支上干活，时不时合并到dev分支。</p>

<p>类似于下图的团队合作：
<img src="\img\git_6" alt="摘自廖雪峰git教程" /></p>

<h3 id="bug">Bug分支</h3>
<p>如果要修复一个紧急Bug，而现有分支上的工作区又不干净，可以先用下面的命令保存工作现场：</p>

<p><code>git stash</code></p>

<p>在完成创建Bug分支并合并到现有分支时，可以再恢复工作现场。
用下面的命令可以查看保存stash列表：</p>

<p><code>git stash list</code></p>

<p>有两种方法可以恢复工作现场
<code>git stash apply</code>
后不会删除stash列表，需要再用<code>git stash drop</code>来删除。</p>

<p><code>git stach pop</code>
在恢复的同时也会删除stash列表。</p>

<p>在多次stash的情况下，可以先查看stash列表，然后再恢复指定的stash：</p>

<p><code>git stash apply stash@{0}</code></p>

<h3 id="feature">Feature分支</h3>
<p>开发一个新feature，最好新建分支。</p>

<p>如果要强行删除未合并分支：</p>

<p><code>git branch -D feature-vulcan</code></p>

<h3 id="section-16">多人协作</h3>

<p>当从远程仓库克隆时，Git自动会把本地<code>master</code>分支和远程<code>master</code>分支对应，远程仓库默认名称是<code>origin</code>。</p>

<p>要查看远程库的信息，使用<code>git remote</code>，<code>git remote -v</code> 显示更详细的信息。
如果要把本地<code>master</code>分支推送到远程：</p>

<p><code>git push origin master</code></p>

<p>如果要推送其他分支，如<code>dev</code>，那就用：</p>

<p><code>git push origin dev</code></p>

<p>注意不是全部分支需要远程推送：</p>

<ul>
  <li>master主分支，dev开发分支需要推送</li>
  <li>bug分支一般用于本地修复，不需推送</li>
  <li>feature分支是否推送取决于是否合作开发</li>
</ul>

<p>从远程库clone时，默认只有本地<code>master</code>分支，如果要创建远程origin/dev分支到本地：</p>

<p><code>git checkout -b dev origin/dev</code></p>

<p>完成开发后就可以<code>push</code>到远程库。但如果想用<code>git pull</code>抓取远程库，还要指定本地dev分支与远程origin/dev分支的连接：</p>

<p><code>git branch --set-upstream dev origin/dev</code></p>

<p>多人协作的工作模式：</p>

<ol>
  <li>首先，尝试用<code>git push origin branch-name</code> 推送自己的修改；</li>
  <li>如果推送失败，是由于远程分支比你的本地更新， 需要先<code>git pull</code>试图合并。</li>
  <li>如果合并有冲突，则解决冲突，并在本地提交</li>
  <li>没有冲突后再次推送。
    <ul>
      <li>如果<code>git pull</code>提示”no tracking information”，说明本地分支和远程分支无关联，参考上面的指令。</li>
    </ul>
  </li>
</ol>

<h2 id="section-17">标签管理</h2>
<p>在发布版本时，打一个标签，可以唯一确定打标签时候的版本。标签是版本库的一个快照，实质是一个不能移动的指向commit的指针。
### 创建标签
首先切换到要打标签的分支上，创建新标签，默认打在最新提交的commit上：</p>

<p><code>git tag v1.0</code></p>

<p><code>git tag</code>查看所有标签</p>

<p>如果是要为历史提交打标签，需要找到对应的<code>commit_id</code>：</p>

<p><code>git tag v0.9 commit_id</code></p>

<p>如果要查看标签，用<code>git tag</code>找到标签名然后使用下面的命令：</p>

<p><code>git show &lt;tagname&gt;</code></p>

<p>创建标签时还能带上说明文字：</p>

<p><code>git tag -a v0.1 -m "version 0.1 released" commit_id</code></p>

<p>用<code>-s</code>则能用私钥签名标签，签名采用PGP签名。需要安装gpg。</p>

<p><code>git tag -s v0.2 -m "signed version 0.2 released" commit_id</code></p>

<h3 id="section-18">操作标签</h3>

<p>标签打错是可以删除的：
<code>git tag -d v0.1</code></p>

<p>如果要把标签推送到远程：</p>

<p><code>git push origin v1.0</code></p>

<p>还可以推送全部标签到远程：</p>

<p><code>git push origin --tags</code></p>

<p>如果要删除远程标签，有些麻烦，需要先在本地删除，然后：</p>

<p><code>git push origin :refs/tags/v0.9</code></p>

<h2 id="github">使用github</h2>
<ul>
  <li>在Github上， 可以任意Fork开源仓库</li>
  <li>自己拥有Fork后的仓库的读写权限</li>
  <li>可以推送pull request给官方仓库来贡献代码</li>
</ul>

<h2 id="git-1">自定义Git</h2>
<p>Git除了最前面的姓名和邮箱，还有很多可以配置的。</p>

<h3 id="section-19">忽略特殊文件</h3>
<p>在git工作区根目录下建一个.gitignore文件，可以指定不想提交的文件。
<a href="https://github.com/github/gitignore">Github官网</a>有不错的示例。</p>

<p>忽略文件原则：</p>

<ul>
  <li>忽略自动生成文件、如缩略图;</li>
  <li>忽略编译生成的中间文件、可执行文件等。</li>
  <li>忽略自己的带敏感信息的配置文件</li>
</ul>

<h3 id="section-20">配置别名</h3>
<p><code>git config --global alias.st status</code>
还有好些有意思的别名参考<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001375234012342f90be1fc4d81446c967bbdc19e7c03d3000">原文</a>。</p>

<p>配置文件存放位置：</p>

<ul>
  <li>每个仓库的配置在<code>.git/config</code></li>
  <li>当前用户(Global)配置在<code>~/.gitconfig</code></li>
</ul>

<h3 id="git-2">搭建git服务器</h3>

<p><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137583770360579bc4b458f044ce7afed3df579123eca000">参考原文</a></p>

